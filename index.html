<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>分液罐設計計算器</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
    h2 { color: #333; }
    .container { display: flex; gap: 30px; flex-wrap: wrap; }
    .input-area, .output-area { background: #fff; padding: 20px; border-radius: 8px; flex: 1; box-shadow: 0 0 10px rgba(0,0,0,0.1); min-width: 320px; }
    label { display: block; margin-top: 10px; }
    input { width: 100%; padding: 6px; margin-top: 4px; }
    .output { margin-top: 10px; color: #d33; font-weight: bold; }
    button { margin-top: 20px; padding: 10px 20px; }
    .svg-area { margin-top: 24px; text-align: center; }
    @media print {
      body { background: #fff; }
      .container { flex-direction: column; gap: 0; }
      button, .print-btn { display: none !important; }
    }
  </style>
</head>
<body>
  <h2>分液罐設計計算器 (依據 SH3009-2013)</h2>
  <div class="container">
    <div class="input-area">
      <h3>輸入區 (Input Area)</h3>
      <label>操作溫度 (°C)<input id="tempC" type="number" value="75.74"></label>
      <label>操作壓力 (KPa)<input id="pressure" type="number" value="150"></label>
      <label>氣體流量 (t/h)<input id="flowRate" type="number" value="65"></label>
      <label>氣體分子量 M (g/mol)<input id="M" type="number" value="54.1"></label>
      <label>氣體動力黏度 Cp (Pa·s)<input id="cp" type="number" value="0.0124"></label>
      <label>液滴直徑 d₁ (m)<input id="d1" type="number" value="0.0006"></label>
      <label>液滴密度 ρl (kg/m³)<input id="rhol" type="number" value="650"></label>
      <label>分液罐直徑 Dw (m)<input id="dw" type="number" value="1.5"></label>
      <label>出入口管徑 (m)<input id="pipeDia" type="number" value="0.6"></label>
    </div>
    <div class="output-area">
      <h3>輸出區 (Output Area)</h3>
      <div class="output" id="results"></div>
      <div class="svg-area">
        <svg id="drum-svg" width="420" height="180" viewBox="0 0 420 180">
          <!-- Drum body -->
          <ellipse cx="210" cy="90" rx="180" ry="70" fill="#e0f7ff" stroke="#0077aa" stroke-width="3" />
          <!-- Liquid level -->
          <rect x="30" y="110" width="360" height="50" fill="#b3e0ff" stroke="#0077aa" stroke-width="1" />
          <!-- Inlet -->
          <rect x="60" y="30" width="30" height="30" fill="#ccc" stroke="#888" stroke-width="2" />
          <polygon points="90,45 120,45 120,60 90,60" fill="#ccc" stroke="#888" stroke-width="2" />
          <text x="65" y="28" font-size="13" fill="#0077aa">氣體入口</text>
          <!-- Outlet -->
          <rect x="330" y="30" width="30" height="30" fill="#ccc" stroke="#888" stroke-width="2" />
          <polygon points="330,45 300,45 300,60 330,60" fill="#ccc" stroke="#888" stroke-width="2" />
          <text x="325" y="28" font-size="13" fill="#0077aa">氣體出口</text>
          <!-- D (直徑) 標註 -->
          <line x1="30" y1="90" x2="390" y2="90" stroke="#f00" stroke-width="2" marker-end="url(#arrow)" marker-start="url(#arrow)" />
          <text x="200" y="80" font-size="13" fill="#f00">D</text>
          <!-- L (長度) 標註 -->
          <line x1="210" y1="20" x2="210" y2="160" stroke="#0a0" stroke-width="2" marker-end="url(#arrow)" marker-start="url(#arrow)" />
          <text x="215" y="100" font-size="13" fill="#0a0">L</text>
          <!-- hl (液位) 標註 -->
          <line x1="390" y1="160" x2="390" y2="110" stroke="#00a" stroke-width="2" marker-end="url(#arrow)" />
          <text x="395" y="140" font-size="13" fill="#00a">hl</text>
          <!-- Arrow marker defs -->
          <defs>
            <marker id="arrow" markerWidth="8" markerHeight="8" refX="4" refY="4" orient="auto" markerUnits="strokeWidth">
              <path d="M0,0 L8,4 L0,8 L2,4 Z" fill="#333" />
            </marker>
          </defs>
        </svg>
        <div style="font-size:13px; color:#555; margin-top:6px;">分液罐剖面示意圖（D：直徑，L：長度，hl：液位）</div>
      </div>
    </div>
  </div>
  <div style="text-align:center; margin: 30px 0 10px 0;">
    <button class="print-btn" onclick="window.print()" style="padding:12px 32px; font-size:1.1em; background:#0077aa; color:white; border:none; border-radius:6px; cursor:pointer;">列印/匯出PDF</button>
  </div>
  <script>
    function calculate() {
      const T = parseFloat(document.getElementById('tempC').value) + 273.15;
      const P = parseFloat(document.getElementById('pressure').value);
      const Q = parseFloat(document.getElementById('flowRate').value);
      const M = parseFloat(document.getElementById('M').value);
      const cp = parseFloat(document.getElementById('cp').value);
      const d1 = parseFloat(document.getElementById('d1').value);
      const rhol = parseFloat(document.getElementById('rhol').value);
      const dw = parseFloat(document.getElementById('dw').value);
      const pipeDia = parseFloat(document.getElementById('pipeDia').value);

      // 氣體密度 ρv (kg/m3)
      const R = 8314.5;
      const rhov = (P * 1000 * M) / (R * T);

      // 液滴沉降速度 Uc (m/s)
      const C = 0.7;
      const Uc = (Math.pow(d1, 2) * 9.81 * (rhol - rhov) * C) / (18 * cp);

      // 查Re與阻力係數
      const Re = rhov * Uc * d1 / cp;
      const C_Re2 = Re * Re;

      // 液面高度 a (m)，設為直徑的一半為估算值
      const a = dw / 2;
      const b = a * dw; // 假設總面積為簡單面積

      // 氣體體積流量 m3/h（理想氣體狀態方程近似）
      const qv = Q * 22.4 * (273.15 + T) / (M * 1000);

      // 補水量 (ton/hr)，假設 1% 揮發損耗
      const refill = Q * 0.01;

      // 分液罐直徑計算值 (估算)
      const D = Math.sqrt(4 * qv / (Math.PI * Uc));

      // 總長度與間距估算
      const L = 2.5 * D;
      const H = L + 1.2;

      const output = `
        <p>氣體密度 ρv：<b>${rhov.toFixed(8)}</b> kg/m³</p>
        <p>液滴沉降速度 Uc：<b>${Uc.toFixed(8)}</b> m/s</p>
        <p>Re² × C 值：<b>${C_Re2.toFixed(5)}</b></p>
        <p>分液罐設計直徑 Dw：<b>${dw}</b> m</p>
        <p>分液罐直徑 (計算值) D：<b>${D.toFixed(2)}</b> m</p>
        <p>進出口間距 L：<b>${L.toFixed(2)}</b> m</p>
        <p>罐體總長度 H：<b>${H.toFixed(2)}</b> m</p>
        <p>液面高度 a：約 <b>${a.toFixed(2)}</b> m</p>
        <p>補水量：約 <b>${refill.toFixed(4)}</b> ton/hr</p>
      `;

      document.getElementById('results').innerHTML = output;
    }
  </script>
</body>
</html>
